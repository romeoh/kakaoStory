var ua=navigator.userAgent,os=/iphone|ipad|ipod/gi.test(ua)?"ios":/android/gi.test(ua)?"android":/mac/gi.test(ua)?"macOS":/windows/gi.test(ua)?"Windows":"other",categoryName,categoryId,categoryIdx,threadIdx,ClevisURL={_patterns:{url:"(?:\\b(?:(?:(?:(ftp|https?|mailto|telnet):\\/\\/)?(?:((?:[\\w$\\-_\\.\\+\\!\\*\\'\\(\\),;\\?&=]|%[0-9a-f][0-9a-f])+(?:\\:(?:[\\w$\\-_\\.\\+\\!\\*\\'\\(\\),;\\?&=]|%[0-9a-f][0-9a-f])+)?)\\@)?((?:[\\d]{1,3}\\.){3}[\\d]{1,3}|(?:[a-z0-9]+\\.|[a-z0-9][a-z0-9\\-]+[a-z0-9]\\.)+(?:biz|com|info|name|net|org|pro|aero|asia|cat|coop|edu|gov|int|jobs|mil|mobi|museum|tel|travel|ero|gov|post|geo|cym|arpa|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|me|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sk|sl|sm|sn|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|za|zm|zw)|localhost)\\b(?:\\:([\\d]+))?)|(?:(file):\\/\\/\\/?)?([a-z]:))(?:\\/((?:(?:[\\w$\\-\\.\\+\\!\\*\\(\\),;:@=\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]|%[0-9a-f][0-9a-f]|&(?:nbsp|lt|gt|amp|cent|pound|yen|euro|sect|copy|reg);)*\\/)*)([^\\s\\/\\?:\\\"\\'<>\\|#]*)(?:[\\?:;]((?:\\b[\\w]+(?:=(?:[\\w\\$\\-\\.\\+\\!\\*\\(\\),;:=\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]|%[0-9a-f][0-9a-f]|&(?:nbsp|lt|gt|amp|cent|pound|yen|euro|sect|copy|reg);)*)?\\&?)*))*(#[\\w\\-\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]+)?)?)",
querystring:RegExp("(\\b[\\w]+(?:=(?:[\\w\\$\\-\\.\\+\\!\\*\\(\\),;:=\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]|%[0-9a-f][0-9a-f]|&(?:nbsp|lt|gt|amp|cent|pound|yen|euro|sect|copy|reg);)*)?)\\&?","gi")},_process:function(c,b){if(!c)throw Error(1,"\uc785\ub825\uac12\uc774 \ube44\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.");return c.match(RegExp(ClevisURL._patterns.url,b))},collect:function(c){return(c=ClevisURL._process(c,"gmi"))?c:[]},parse:function(c,b){var a=ClevisURL._process(c,"mi");if(!a)return{};a[2]&&(a[2]=
a[2].split(":"));if(a[9]){a[9]=a[9].match(ClevisURL._patterns.querystring);for(var e=0;e<a[9].length;e++)a[9][e]=a[9][e]?a[9][e].replace(/\&$/,"").split("="):[],1==a[9][e].length&&(a[9][e][1]="")}if(!a[1]&&!a[5]){if(a[3])if(a[0].match(RegExp("^("+a[2][0]+"@"+a[3]+")$")))a[1]="mailto";else switch(a[4]){case 21:a[1]="ftp";break;case 23:a[1]="telnet";break;case 443:a[1]="https";break;default:a[1]="http"}else a[5]="file";a[0]=(a[1]?a[1]+"://":a[5]+":///")+a[0]}return{url:a[0],protocol:a[1]?a[1]:a[5],
userid:a[2]?a[2][0]:"",userpass:a[2]?a[2][1]:"",domain:a[3]?a[3]:"",port:a[4]?a[4]:"",drive:a[6]?a[6]:"",directory:a[7]?a[7]:"",filename:a[8]?a[8]:"",querys:a[9]?a[9]:"",anchor:a[10]?a[10]:""}}};if("ios"!=os&&"android"!=os)var adTop=document.querySelector("#adTop"),adMiddle=document.querySelector("#adMiddle");window.addEventListener("DOMContentLoaded",function(){ready()},!1);
function ready(){requestCategory();M("#goTest").on("click",function(){window.location.href="http://goo.gl/pxiUqd"});M("#write").on("click",function(){"none"==M("#new").css("display")?M("#new").css("display","block"):M("#new").css("display","none")});M("#tarea").on("keyup",function(c,b){M("#tinfo").html("<b>"+b.val().length+"</b>/160")});M("#tbutton").on("click",function(c,b){""==M("#tarea").val()?alert("\uc5b4\ub5a4 \uc0dd\uac01\uc774\uc138\uc694?"):regist()})}
function requestCategory(){bodyData={body:{type:"category"},head:{}};$.ajax({url:"http://romeoh78.appspot.com/api/macao/get",contentType:"text/plain",data:M.json(bodyData),type:"POST",success:function(c){c=M.json(c).body.categorys[0];M("#category").html(c.category_nm);categoryName=c.category_nm;categoryId=c.category_id;categoryIdx=c.category_idx;requestThread()}})}
function requestThread(){var c={type:"thread"};c.category_idx=categoryIdx;bodyData={body:c,head:{}};$.ajax({url:"http://romeoh78.appspot.com/api/macao/get",contentType:"text/plain",data:M.json(bodyData),type:"POST",success:function(c){c=M.json(c).body.threads[0];M("#thread").html("<b>["+c.thread_title+"]:<br></b>"+c.thread_content.replace(/\n/gi,"<br>"));threadIdx=c.thread_idx;requestTimeline()}})}
function requestTimeline(c){var b={};b.category_id=categoryId;b.thread_idx=threadIdx;void 0!=c&&(b.from=c);b.count=20;bodyData={body:b,head:{}};$.ajax({url:"http://romeoh78.appspot.com/api/macao/timeline",contentType:"text/plain",data:M.json(bodyData),type:"POST",success:function(a){a=M.json(a).body;idxNext=a.idx_next;command=a.commands;for(var c=0;c<command.length;c++){var b=a.category_idx+""+a.thread_idx+""+command[c].command_idx,d=command[c].content,f=ClevisURL.collect(d),h;f[0]?(h=f[0].replace("http://",
"").replace("https://","").replace("www.",""),h=d.replace(f,'<a href="'+f+'" target="_blank">'+h+"</a>")):h=d;M("#timeline").append("li",{"data-feed":b,"data-category":a.category_idx,"data-thread":a.thread_idx,"data-id":a.category_id,"data-command":command[c].command_idx,className:"feed"});d="";d+='<div class="idx" data-feed-li-title="'+b+'">@'+b+"</div>";d+='<div class="content" data-feed-li="'+b+'"><p data-content="'+b+'">'+h+'</p><p class="time">'+M.dynamicDate(command[c].reg_date)+"</p></div>";
d+='<ul class="menu" data-menu="'+b+'">';d+='\t<li data-good="'+b+'"><img src="../imgApp/ico_good.png" alt=""><p>'+M.toCurrency(command[c].good)+"</p></li>";d+='\t<li data-bad="'+b+'"><img src="../imgApp/ico_bad.png" alt=""><p>'+M.toCurrency(command[c].bad)+"</p></li>";d+='\t<li data-favorite="'+b+'"><img src="../imgApp/ico_kas.png" alt=""><p>'+M.toCurrency(command[c].favorite)+"</p></li>";d+='\t<li data-delete="'+b+'"><img src="../imgApp/ico_del.png" alt=""></li>';d+="</ul>";M('[data-feed="'+b+'"]').html(d);
changeVal=macao("feed").join("|");RegExp("^(?:"+changeVal+")$","i").test(b)&&(M('[data-delete="'+b+'"]').css("display","block"),M('[data-menu="'+b+'"]').addClass("my"))}M("[data-good]").on("click",function(a,c){var b=c.parent().parent(),d=parseInt(b.data("category"),10),f=parseInt(b.data("thread"),10),e=parseInt(b.data("command"),10),b=b.data("id");M.storage("io.github.romeoh.macao");change("good",d,f,e,b)});M("[data-bad]").on("click",function(a,c){var b=c.parent().parent(),d=parseInt(b.data("category"),
10),f=parseInt(b.data("thread"),10),e=parseInt(b.data("command"),10),b=b.data("id");change("bad",d,f,e,b)});M("[data-favorite]").on("click",function(a,c){var b=c.parent().parent(),d=parseInt(b.data("category"),10),f=parseInt(b.data("thread"),10),e=parseInt(b.data("command"),10),b=b.data("id");change("favorite",d,f,e,b)});M("[data-delete]").on("click",function(a,c){var b=c.parent().parent(),d=b.data("category"),f=b.data("thread"),b=b.data("command");deleteFeed("command",d,f,b)});M("#btnMore").on("click",
function(a,b){requestTimeline(idxNext)});!1===a.has_next&&(M("#btnMore").css("display","none"),M(".btnBox").html("\ub9c8\uc9c0\ub9c9\uc785\ub2c8\ub2e4."));M("[data-feed-li-title]").on("click",function(a,b){M("#new").css("display","block");M("#tarea").val(M("#tarea").val()+"@"+b.parent().data("feed")+" ");M("#tinfo").html("<b>"+M("#tarea").val().length+"</b>/160");M.scroll(0)})}})}
function macao(c,b){var a={good:[],bad:[],favorite:[],feed:[]};_macao=M.json(M.storage("io.github.romeoh.macao"));"null"===_macao&&M.storage("io.github.romeoh.macao",M.json(a));if(void 0==b)return _macao[c];_macao[c].push(b);M.storage("io.github.romeoh.macao",M.json(_macao))}
function change(c,b,a,e,g){var d=macao(c).join("|");if("favorite"!=c&&RegExp("^(?:"+d+")$","i").test(b+""+a+""+e))return alert("\uc774\ubbf8 \uc801\uc6a9\ud588\uc2b5\ub2c8\ub2e4."),!1;d={};d.type=c;d.category_idx=b;d.thread_idx=a;d.command_idx=e;d.category_id=g;bodyData={body:d,head:{}};$.ajax({url:"http://romeoh78.appspot.com/api/macao/change",contentType:"text/plain",data:M.json(bodyData),type:"POST",success:function(a){a=M.json(a).body;var b=a.category_idx+""+a.thread_idx+""+a.command_idx;M('[data-good="'+
b+'"] p').text(a.good);M('[data-bad="'+b+'"] p').text(a.bad);M('[data-favorite="'+b+'"] p').text(a.favorite);macao(c,b);"favorite"===c&&(a="[\ub9c9\uce74\uc624 \uc2a4\ud1a0\ub9ac]\n"+("@"+b+" "+M('[data-content="'+b+'"]').text()+"\n\n"),a+="\ub9c9\uce74\uc624\uc2a4\ud1a0\ub9ac \ubc14\ub85c\uac00\uae30: http://goo.gl/HMF8gs\n",urlMsg={title:"\ub9c9\uce74\uc624 \uc2a4\ud1a0\ub9ac",desc:"\uce74\uc2a4\uc5d0\uc11c\ub294 \ud558\uc9c0 \ubabb\ud588\ub358\ub9d0, \uc798\ub09c\ucc99, \uc788\ub294\ucc99, \uc774\uc81c \ub9c9\uce74\uc624\uc5d0\uc11c \ub9c8\uc74c\ub300\ub85c \ud558\uc790!!",
imageurl:["http://romeoh.github.io/kakaoStory/img/macao.png"],type:"article"},kakao.link("story").send({post:a,appid:"funnyApp",appver:"1.0",appname:"\uac00\ubcbc\uc6b4 \uc775\uba85\ud2b8\uc704\ud130",urlinfo:JSON.stringify(urlMsg)}),console.log(a,urlMsg))}})}
function regist(){var c={type:"command"};c.category_id=categoryId;c.thread_idx=threadIdx;c.commnad_content=M("#tarea").val().replace(/\n/g,"<br>");bodyData={body:c,head:{}};$.ajax({url:"http://romeoh78.appspot.com/api/macao/add",contentType:"text/plain",data:M.json(bodyData),type:"POST",success:function(b){b=M.json(b).body;macao("feed",b.category_idx+""+b.thread_idx+""+b.command_idx);window.location.reload(!0)}})}
function deleteFeed(c,b,a,e){var g={};g.type=c;g.category_idx=parseInt(b,10);g.thread_idx=parseInt(a,10);g.command_idx=parseInt(e,10);bodyData={body:g,head:{}};$.ajax({url:"http://romeoh78.appspot.com/api/macao/del",contentType:"text/plain",data:M.json(bodyData),type:"POST",success:function(a){a=M.json(a).head;!0==a.rst?window.location.reload(!0):alert("\uc0ad\uc81c\ud558\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4.")}})};